* TOC
{:toc}



# 应用部署的时代变迁



**在部署应用程序的方式上，主要经历了三个时代：**

- **传统部署**：互联网早期，会直接将应用程序部署在物理机上

  > 优点：简单，不需要其它技术的参与
  >
  > 缺点：不能为应用程序定义资源使用边界，很难合理地分配计算资源，而且程序之间容易产生影响

- **虚拟化部署**：可以在一台物理机上运行多个虚拟机，每个虚拟机都是独立的一个环境

  > 优点：程序环境不会相互产生影响，提供了一定程度的安全性
  >
  > 缺点：增加了操作系统，浪费了部分资源

- **容器化部署**：与虚拟化类似，但是共享了操作系统

  > 优点：
  >
  > ​    可以保证每个容器拥有自己的文件系统、CPU、内存、进程空间等
  >
  > ​    运行应用程序所需要的资源都被容器包装，并和底层基础架构解耦
  >
  > ​    容器化的应用程序可以跨云服务商、跨Linux操作系统发行版进行部署



![](/images/kubernetes/default/k8s-summary/summary-1.png)



容器化部署方式给带来很多的便利，但是也会出现一些问题，比如说：

- 一个容器故障停机了，怎么样让另外一个容器立刻启动去替补停机的容器
- 当并发访问量变大的时候，怎么样做到横向扩展容器数量

这些容器管理的问题统称为**容器编排**问题，为了解决这些容器编排问题，就产生了一些容器编排的软件：

- **Swarm**：Docker自己的容器编排工具
- **Mesos**：Apache的一个资源统一管控的工具，需要和Marathon结合使用
- **Kubernetes**：Google开源的的容器编排工具

<img src="/images/kubernetes/default/k8s-summary/summary-3.png" alt="image-20200524150339551" style="border:1px solid;zoom:110%;" />





# kubernetes简介



![](/images/kubernetes/default/k8s-summary/summary-7.png)

​    

**Kubernetes是用于自动部署，扩展和管理容器化应用程序的开源系统。**

Kubernetes是一个可移植、可扩展的**开源平台**，用于管理容器化的工作负载和服务，可促进声明式配置和自动化。Kubernetes拥有一个庞大且快速增长的生态，其服务、支持和工具的使用范围相当广泛。

Kubernetes 这个名字源于希腊语，意为“舵手”或“飞行员”。k8s这个缩写是因为k和s之间有八个字符的关系。Google在2014年开源了Kubernetes项目。Kubernetes建立在Google大规模运行生产工作负载十几年经验的基础上，结合了社区中最优秀的想法和实践。

 

**Kubernetes能够实现：**

-  **服务发现和负载均衡**

Kubernetes可以使用DNS名称或自己的IP地址来曝露容器。如果进入容器的流量很大，Kubernetes可以负载均衡并分配网络流量，从而使部署稳定。

- **存储编排**

Kubernetes允许你自动挂载你选择的存储系统，例如本地存储、公共云提供商等。

- **自动部署和回滚**

你可以使用Kubernetes描述已部署容器的所需状态，它可以以受控的速率将实际状态更改为期望状态。例如，你可以自动化Kubernetes来为你的部署创建新容器，删除现有容器并将它们的所有资源用于新容器。

- **自动完成装箱计算**

Kubernetes允许你指定每个容器所需CPU和内存（RAM）。当容器指定了资源请求时，Kubernetes可以做出更好的决策来为容器分配资源。

- **自我修复**

Kubernetes将重新启动失败的容器、替换容器、杀死不响应用户定义的运行状况检查的容器，并且在准备好服务之前不将其通告给客户端。

- **密钥与配置管理**

Kubernetes允许你存储和管理敏感信息，例如密码、OAuth令牌和ssh密钥。你可以在不重建容器镜像的情况下部署和更新密钥和应用程序配置，也无需在堆栈配置中暴露密钥。





# kubernetes组件



![](/images/kubernetes/default/k8s-summary/summary-8.png)



**Kubernetes** **主要由以下几个核心组件组成：**

- **Etcd：**保存了整个集群的状态

- **Apiserver：**提供了资源操作的唯一入口，并提供认证、授权、访问控制、API注册和发现等机制

- **controller manager：**负责维护集群的状态，比如故障检测、自动扩展、滚动更新等

- **scheduler：**负责资源的调度，按照预定的调度策略将 Pod调度到相应的机器上

- **kubelet：**负责维护容器的生命周期，同时也负责Volume（CSI）和网络（CNI）的管理

- **Container runtime：**负责镜像管理以及Pod和容器的真正运行（CRI）

- **kube-proxy：**负责为Service提供cluster内部的服务发现和负载均衡

 

**除了核心组件，还有一些推荐的插件，其中有的已经成为CNCF中的托管项目：**

- **CoreDNS：**负责为整个集群提供DNS服务

- **Ingress Controller：**为服务提供外网入口

- **Prometheus：**提供资源监控

- **Dashboard：**提供GUI





# kubernetes概念



- **Master**：集群控制节点，每个集群需要至少一个master节点负责集群的管控
- **Node**：工作负载节点，由master分配容器到这些node工作节点上，然后node节点上的docker负责容器的运行
- **Pod**：kubernetes的最小控制单元，容器都是运行在pod中的，一个pod中可以有1个或者多个容器
- **Controller**：控制器，通过它来实现对pod的管理，比如启动pod、停止pod、伸缩pod的数量等等
- **Service**：pod对外服务的统一入口，下面可以维护者同一类的多个pod
- **Label**：标签，用于对pod进行分类，同一类pod会拥有相同的标签
- **NameSpace**：命名空间，用来隔离pod的运行环境



